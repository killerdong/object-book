# 역할, 책임, 협력

* 객체지향 페러다임의 관점에서 핵심은 역할(Role), 책임(responsibility), 협력(collaboration)이 중요하다.
* 객체지향의 본질은 협력하는 객체들의 공동체를 창조하는 것이고, 핵심은 협력을 구성하기 위해 적절한 객체를 찾고 적절한 책임을 할당하는 과정에서 드러난다.

* 협력: 객체들이 애플리케이션의 기능을 구현하기 위해 수행하는 상호작용
* 책임: 객체가 협력에 참여하기 위해 수행하는 로직
* 역할: 객체들이 협력 안에서 수행하는 책임들이 모여있는 집합

## 협력

* 객체는 시스템의 기능이라는 더 큰 목표를 달성하기 위해 다른 객체와 협력하는 사회적인 존재
* 두 객체 사이의 협력은 하나의 객체가 다른 객체에게 도움을 요청할 때 시작되며 이 것을 메세지 전송(message sending)이라고 한다.
* 메세지를 수신한 객체는 메서드를 실행해서 요청에 응답
* 객체가 메시지를 처리할 방법(메서드)를 스스로 선택한다는 점이 중요
```javascript
//Screening 
    private calculateFee(audienceCount: number) {
        return this.moive.calculateMovieFee(this).times(audienceCount); //Movie 객체에 calculateMovieFee 메세지 전송
    }


//Movie 객체에서는 calculateMovieFee 메시지를 받을 경우 calculateMovieFee 메서드를 실행
    calculateMovieFee(screening: Screening) {
        //메세지를 받아서 처리하는 부분
        return this.fee.minus(this.discountPolicy.calculateDiscountAmount(screening));
    }
```
* 자율적인 객체는 자신에게 할당된 책임을 수행하던 중에 필요한 정보를 알지 못하거나 외부의 도움이 필요한 경우 적절한 객체에게 메시지를 전송해서 협력을 요청
* 이처럼 객체들 사이의 협력을 구성하는 일련의 요청과 응답의 흐름을 통해 애플리케이션의 기능이 구현된다.

### 협력이 설계를 위한 문맥을 결정한다.

* 문맥(context): 컨텍스트는 텍스트의 단순한 표면적 의미를 넘어서 주변 상황, 시간, 환경 등이 고려된 좀 더 깊은 곳에 숨겨져 있는 진의(眞意) 혹은 피상(皮相)을 넘어선 깊이 혹은 진의를 파악하고자 할 때 반드시 고려되어야 할 부분 [출처](http://blog.rightbrain.co.kr/?p=8770)
* 객체지향: 객체를 중심에 높는 프로그램밍 패러다임
* 객체: 상태와 행동을 함께 캡슐화하는 실행 단위
* 애플리케이션 안에 어떤 객체가 필요하다면 그 객체에는 협력에 필요한 적절한 행동을 가지고 있으며,그렇게 때문에 협력에 참여할 수 있다.
* 객체의 행동을 결정하는 것이 협력이라면 객체의 상태를 결정하는 것은 행동
```typescript
export default class Movie {

    //2. 영화 여금 계산 행동을 위해서 원가와 할인 정책의 상태를 가져야 한다.
    fee: Money;                     
    discountPolicy: DiscountPolicy;

    constructor(fee: Money,     
        discountPolicy: DiscountPolicy) {
        this.fee = fee;
        this.discountPolicy = discountPolicy;
    }

    calculateMovieFee(screening: Screening) {   //1. 예매라는 협력을 위하 Moive에서는 영화 요금 계산 행동을 가져아한다.
        return this.fee.minus(this.discountPolicy.calculateDiscountAmount(screening));
    }
}
```
* 협력은 객체를 구성하는 행동과 상태를 모두 결정할 수 있기 때문에 객체를 설계하는 데 필요한 인종의 문맥(Context)

## 책임

### 책임이란?

* 협력에 참여하기 위해 객체가 수행하는 행동
* 책임에는 `하는 것(doing)`과 `아는 것(knowing)` 두 가지 범주로 나눠진다.
    * 하는 것
        * 객체를 생성하거나 계산을 수행하는 등의 스스로 하는 것
        * 다른 객체의 행동을 시작시키는 것
        * 다른 객체의 활동을 제어하고 조절하는 것
    * 아는 것
        * 사적인 정보에 관해 아는 것
        * 관련된 객체에 관해 아는 것
        * 자신이 유도하거나 계산할 수 있는 것에 관해 아는 것

* `Screeeing`를 예로 들면 하는 것은 `예매`하는 것이고, 아는 것은 `자신이 상영할 영화`가 아는 것이다.
* 협력 안에서 객체에게 할당한 책임이 외부의 인터페이스와 내부의 속성을 결정
* 책임은 객체가 수행할 수 있는 행동을 종합적으로 간략하게 서술하기 때문에 메시지보다 추상적이고 개념적으도 더 큼
* 협력이 중요한 이유는 객체에게 할당할 책임을 결정할 수 있는 문맥을 제공하기 때문
* 적절한 협력이 적절한 책임을 제공하고, 적절한 책임이 적절한 객체에게 할당해야만 단순하고 유연한 설계를 창조할 수 있다.
* 객체 지향 설계에서 가장 중요한 것은 책임

### 책임 할당

* INFORMATION EXPERT 패턴: 책임을 수행하는 데 필요한 정보를 가장 잘 알고 있는 전문가에게 그 책임을 할당하는 것
* 객체지향 설계는 시스템의 책임을 완료하는 데 필요한 더 작음 책임을 찾아내고 이를 객체들에게 할당하는 반복적인 과정을 통해 모양을 갖춰감
* 객체지향 설계는 협력에 필요한 메시지를 찾고 메시지에 적절한 객체를 선택하는 반복적인 과정을 통해 이뤄지고 이런 메시지가 메시지를 수신할 객체의 책임을 결정
* 이렇게 결정된 메시지가 객체의 퍼블릭 인터페이스를 구성
* 기본적인 전략은 책임을 수행할 수 있는 정보 전문가를 찾는 것이고, 정보 전문가에게 책임을 할당함으로써 상태와 행동을 함께 가지는 자율적인 객체를 만들 가능성이 높아진다.

### 책임 주도 설계

* 책임 주도 설계(Responsibility-Driven Design: RDD): 책임을 찾고 책임을 수행할 적절한 객체를 찾아 책임을 할당하는 방식으로 협력을 설계하는 방법
* 책임 주도 설게 과정
    * 시스템이 사용자에게 제공해야 하는 기능인 시스템 책임을 파악
    * 시스템 책임을 더 작은 책임으로 분할
    * 분할된 책임을 수행할 수 있는 적절한 객체 또는 역할을 찾아 책임을 할당
    * 객체가 책임을 수행하는 도중 다른 객체의 도움이 필요한 경우 이를 책임질 적절한 객체 또는 역할을 찾는다.
    * 해당 객체 또는 역할에게 책임을 할당함으로써 두 객체가 협력하게 한다.
* 구현이 아닌 책임에 집중하는 것이 중요한 이유는 유욘하고 견고한 객체지향 시스템을 위해 가장 중요한 재료가 바로 책임

### 메시지가 객체를 결정

* 객체가 메시지를 선택하는 것이 아니라 메시지가 객체를 선택해야 한다.
* 메시지가 객체를 선택해야 하는 이유
   1. 객체가 최소한의 인터페이스를 가질 수 있게 된다.
   2. 객체는 충분히 추상적인 인터페이스를 사질 수 있게 된다.

### 행동이 상태를 결정

* 객체를 객체답게 만드는 것은 객체의 상태가 아니라 객체가 다른 객체에게 제공하는 행동
* 구현에 대한 결정을 뒤로 미루면서 객체의 행위를 고려하기 위해서는 항상 협력이라는 문맥 안에서 객체를 생각해야 함

## 역할

### 역할과 협력

* 객체가 어떤 특정한 협력 안에서 수행하는 책임의 집합
* 협력을 모델링할 때는 특정한 객체가 아니라 역할에게 책임을 할당한다고 생각
* 익명의 역할을 찾고 그 역할을 수행할 수 있는 객체를 선택하는 방식으로 설계가 진행

### 유연하고 재사용 가능한 협력

* 객체가 아닌 책임에 초점을 맞춰야 한다.
* 역할은 일종의 슬롯으로 객체를 교대로 바꿔서 끼울 수 있음
* 동일한 책임을 수행하는 역할을 기반으로 여러가지의 협력을 하나로 통합할 수 있다는 점
* 중복 코드 제거가 가능

### 객체대 역할

* 협력에 참여하는 후보가 여러 종류의 객체에 의해 수행될 필요가 있다면 그 후보는 역할이 되지만 단지 한 종류의 객체만이 협력에 참여할 필요가 있다면 후보는 객체가 된다.

### 역할과 추상화

* 추상화를 통한 장점 2가지 전부 동일하게 적용 가능
    * 추상화 계층만을 이용하면 중요한 정책을 상위 수준에서 단순화할 수 있다는 것
    * 설계가 좀 더 유연해진다는 것

### 배우와 배역

* 협력이라는 문맥 안에서 역할은 특정한 협력에 참여해서 책임을 수행하는 객체의 일부
* 역할은 객체가 협력에 참여하는 잠시 동안에만 존재하는 일시적인 개념
* 역할은 특정한 객체의 종류를 캡슐화하기 때문에 동일한 역할을 수행하고, 계약을 준하는 대체 가능한 객체들은 다형적이다.